language: php

php:
  - 5.4

services:
  - mysql

# faster builds on new travis setup not using sudo
sudo: false

# cache vendor dirs
cache:
  directories:
    - vendor

before_install:
  - mysql -e "create database IF NOT EXISTS kuhiw_test;" -u root
  - mysql -u root kuhiw_test < database/kuhiw_test.sql

# install dependencies
install:
  - composer install

before_script:
  - cp config.example.php config.php
  - php -S localhost:8000 &
  - sleep 3

script: vendor/bin/phpunit

env:
  global:
    - secure: BpfrZAxyaWtRxVWla//uCdGQn3tyJ9jJHh3P+gVSmCtMapNWZ76bZ8zN39+EpZ8kAwXxx6HYRQNeJWfVsm7L6oipa4ZOioaHciNs0Tj8u/o1mZEtJbtU/BKJMR3nYvhiKSfj4hF8yBdiThPjWoCNuu2OXADs0bKmEJJkx4nrbNWJkVK9pVuc1oTu0nikv5mP5Gw/rBSrvtopqSHvhma1W5YiKTpn8lM9KMBZasAyQMw53LCWwSCM7ZshWdjXVj3ch+kX6oVHpo2ArKEZeSgMbzo8/YHU+t9MPj8320e2HPSzPp6YTd33yN3By3QX15HhFDKt2CtZEXVvOwrw9UhA6W4jZy3bkjzUZyWIuWnGkSsFwJrseQsnk5D3dhKYCOxP3zUUhxY3u5Z1zIsz0sjCZYWOCimacvzj3myCfQBWFu9i9QIEjm4r9wMhld9/97I3r079GlWDuHc8N3xK2W2i9/ZcIcmvTiweO9GWyb1i8WT7nrAvlUCqqGo9jHpgSV0L3YI10LdgbjZmHHHHiHK6cgN+flYhKZ6CNheCeTKQvmKj+2BOMlYpsKp8+FXqcdyq74lJqojzH3TS8VRKLZ8G03g2atP9wk2vDFvtbxccpFclk8o5gZOEAX7m8PhGcP46oT3POdasFJZbYhluyq5DuBd/t6aB+xqgdiPD1OgnJRA=
    - secure: GpeBes8gc1weenpV+qwtyIBtvIc9EnokfCbBQ6IWMa3OHT8WOk2IoDbL531AmusfEInEwPsjub21vhXBq3BeAtSuHPYQP5T62Sht4wi6YA4MKKZqjkzkK1gcxRNShItz4fPigfBzqi6C32nJfrEHAYAyJGPy7gQlBcLMScoEQ1dEww23XMZ8C+OdPSmVD9T9dJCamzv59nfSESC7PWCgEi0fPHlVFek10pfmvjajy65sp0QTJv4y5e07kh4fsyoGVXvlljEtk816oWnOfz3wfWyX4D+kPfViWUD3DjOwMCHRZny/jjzB81DPr8nzi6nkhzS1q3TE3JLpY0mdWJAFuLWFU+Z5cQ3wp8kS4PJjc5oL/fb37N62a1Pa5CUcVAn7SxM1APv/2utONtdWiZP+shgDqJVWi8edOuDxS5z0X4toP5ZLO+C5xwHQFUi5vSunPl/ZWV0f376JDPKx4jCIB4J5tnpaT1JD4s1MAXDCP8bQCKAj3/UcisQcWvPFcxfgTponPDpoJ/AFzkJChHs3i0yI9qMSURl842CItLZ2jAuRIxFALYcCGRDA7FSvE9Cm0M+1B8yGs/ffYodPnQe1m2bMTcV548VwHqlRzmHNpf6M9+ubh8cWZVDJ+EK9DvUhWfX/pDkBnRKGSxgZk4iubyjo9ISh2iYDt7vyM9IEVqY=
    - secure: DQR5gqCqPTI0Ns5rASMzIXr3XfULrHQQNR88huVEz0BMohuZ0Enei5j4g4PH35QeZs/SzIAj1inBdOt32jWz2IUoDTMGCs5vpVp9VBY2IWn3YChAPIrfOfA5HG3JAf6ZkM7uJVV25foClX72nIEn6XyBssdlOKLw9O6Ufz7x8cOv0+R41uVNSLrr+BtvxC9czwnQHOi8As5IxOyjyP3jxex8yHTBb7vhZwy4C0AxAU+yl3jQf8JGx+PTMKDCQXg6JoQnjhKGCexe0uDvJSDT1KffPvlJ+aEse9ShJj/hwHaVRwF0nce+5qxkTi5SdA4E5qXl1g3vVmYkebOhNwySntNweri/UdCS3QBG8eq9TRIVawxhVIDevP9Jv5UpKT4A/lPzAOUm+7GgdWaMhnXky3L+ia2y0E7czWRZ4my0x01koHBDSUKENSQSkG+kGNIX+B5cL3bQFZP8YrY/iOXBWQ2+jF8xyB0Wq3xiDsuHbFz7UOB6n0XwTH83gRwDCE4EgG32FCxiEELR+4pDGqpyifITR1RweJ7YM+2dbyjxNucSJ6gmfOgVd8kTf/VSngFia54ZVw91uRVafG/CFjl6M6lZZC6qRwrqByurqdUhooCtwy7U+zmtxYo7aKBtTdS8mPKw8MIQe4VxxEl+X63/2+2AmpMB9NQY167mMSwakIg=

after_success:
  - cd ..
  - cp -R kuhiw-webservice kuhiw
  - cd kuhiw
  - rm -rf .git
  - composer install --no-dev
  - cd ..
  - find kuhiw -type f -exec curl -u $FTP_USER:$FTP_PASSWORD --ftp-create-dirs -T {} ftp:$BASE_URL{} \